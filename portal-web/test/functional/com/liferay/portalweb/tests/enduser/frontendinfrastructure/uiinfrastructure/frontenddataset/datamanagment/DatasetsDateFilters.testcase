@component-name = "portal-frontend-infrastructure"
definition {

	property custom.properties = "feature.flag.LPS-164563=true";
	property portal.acceptance = "true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.component.names = "Frontend Dataset";
	property testray.main.component.name = "Frontend Dataset";

    setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		task ("Given the creation of a new dataset") {
			FrontendDataSetAdmin.goToDatasetAdminPage();

			JSONFrontendDatasetEntries._createDatasetEntry(
				datasetName = "Dataset Fields Test",
				restApplication = "/headless-admin-taxonomy/v1.0",
				restEndpoint = "/v1.0/keywords/ranked",
				restSchema = "Keyword");
		}

		task ("And adding a dataset view") {
			JSONFrontendDatasetEntries._createFDSViewViaAPI(
				datasetName = "Dataset Fields Test",
				dataSetViewDescription = "FDSViewDescription",
				dataSetViewName = "View Fields Test");
		}

		task ("When go to the View page of the dataset created.") {
			FrontendDataSetAdmin.goToSpecificViewPage(
				datasetName = "Dataset Fields Test",
				key_viewName = "View Fields Test");
		}
        
        task ("When the user accesses the Filters tab") {
			FrontendDataSetAdmin.goToTab(tabName = "Filters");
		}
    }

    tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		FrontendDataSetAdmin.deleteAllDatasetEntries();

		if (${testPortalInstance} == "true") {
			PortalInstances.tearDownCP();
		}
	}

    @description = "LPS-185344 - Confirms the From and To fields are displayed when creating a new date filter."
	@priority = 5
	test AssertDateFieldsArePresent {
		task("And click on the 'Create Filter' button") {
			Button.click(button = "Create Filter");
		}

		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds 'dateCreated' to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");			
		}

		task("Then 'From' field is present") {
			AssertVisible(locator1= "FrontendDataSetAdmin#LABEL",
				key_label = "From");
		}

		task("And 'To' field is also present ") {
			AssertVisible(locator1= "FrontendDataSetAdmin#LABEL",
				key_label = "To");
		}
	}

	@description = "LPS-185346 - Confirms the date fields values when creating a new date filter are YYYY-MM-DD."
	@priority = 3
	test AssertDateFieldsFormat {
		task("And click on the 'Create Filter' button") {
			Button.click(button = "Create Filter");
		}
		
		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds 'dateCreated' to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");
		}

		task("Then the default value is 'YYYY-MM-DD' in 'From' field"){
			AssertVisible(locator1 = "FrontendDataSetAdmin#DATE_FIELD_PLACEHOLDER",
			key_placeholderText = "YYYY-MM-DD",
			key_dateField = "From");
		}

		task("And the default value is 'YYYY-MM-DD' in 'To' field") {
			AssertVisible(locator1 = "FrontendDataSetAdmin#DATE_FIELD_PLACEHOLDER",
			key_placeholderText = "YYYY-MM-DD",
			key_dateField = "To");
		}
	}

	@description = "LPS-185348 - Confirms the Clay datepicker can be opened when creating a new date filter."
	@priority = 5
	test AssertDateFieldsClayDatePicker {
		task("And click on the 'Create Filter' button") {
			Button.click(button = "Create Filter");
		}
		
		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds 'dateCreated' to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");
		}

		task("And clicks on From field datepicker"){
			Click(locator1= "FrontendDataSetAdmin#DATEPICKER_BUTTON",
			key_dateField = "From");
		}

		task("Then the Clay Date picker is open"){
			AssertVisible(locator1 = "FrontendDataSetAdmin#DATEPICKER_MENU");

			Click(locator1= "FrontendDataSetAdmin#DATEPICKER_BUTTON",
			key_dateField = "From");
		}

		task("When the user clicks on To field datepicker"){
			Click(locator1= "FrontendDataSetAdmin#DATEPICKER_BUTTON",
			key_dateField = "To");
		}

		task("Then the Clay Date picker is open"){
			AssertVisible(locator1 = "FrontendDataSetAdmin#DATEPICKER_MENU");

			Click(locator1= "FrontendDataSetAdmin#DATEPICKER_BUTTON",
			key_dateField = "To");
		}

	}

	@description = "LPS-185352 - Confirms an error message is displayed when the user tries to create a new date filter with invalid date range."
	@priority = 4
	test CannotSaveAnInvalidDateRangeInDateFields {
		task("And click on the 'Create Filter' button") {
			Button.click(button = "Create Filter");
		}
		
		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds 'dateCreated' to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");
		}

		task("And selects a date on From field"){
			FrontendDataSet.selectFromFieldDates(key_dateNumber = "20");
		}

		task("And selects a date on To field that is before From field date") {
			FrontendDataSet.selectToFieldDates(key_dateNumber = "13");
		}

		task("Then an error message appears"){
			AssertVisible(locator1 = "FrontendDataSetAdmin#NEW_FILTER_INVALID_DATE");
		}
	}

	@description = "LPS-185354 - Confirms the user can cancel a new date filter creation."
	@priority = 4
	test CanCancelDateFilterCreation {
		task("And click on the Create Filter button") {
			Button.click(button = "Create Filter");
		}
		
		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds 'dateCreated' to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");
		}

		task("And selects a date on From field"){
			FrontendDataSet.selectFromFieldDates(key_dateNumber = "10");
		}

		task("And selects a date on To field") {
			FrontendDataSet.selectToFieldDates(key_dateNumber = "20");
		}

		task("And clicks on Cancel button"){
			Click(locator1 = "FrontendDataSetAdmin#NEW_FILTER_CANCEL_BUTTON");
		}

		task("Then New filter modal is closed and the changes are not applied"){
			AssertVisible(locator1= "FrontendDataSetAdmin#CREATE_FILTER_BUTTON");
		}
	}

	@description = "LPS-185357 - Confirms the user can save a new date filter."
	@priority = 5
	test CanSaveDateFilter {
		task("And click on the Create Filter button") {
			Button.click(button = "Create Filter");
		}
		
		task("When the user adds a name") {
			Type(locator1 = "FrontendDataSetAdmin#NEW_FILTER_NAME",
				value1 = "Test");
		}

		task("And adds dateCreated to the filter") {
			Type(locator1 = "FrontendDataSetAdmin#FILTER_BY_DROPDOWN",
				value1 = "dateCreated");
		}

		task ("And selects a date on From field") {
			FrontendDataSet.selectFromFieldDates(key_dateNumber = "15");
		}

		task ("And selects a date on To field"){
			FrontendDataSet.selectToFieldDates(key_dateNumber = "25");
		}

		task("And clicks on the Save button"){
			Click(locator1 = "FrontendDataSetAdmin#NEW_FILTER_SAVE_BUTTON");
		}

		task("Then a successful message is displayed"){
			Alert.viewSuccessMessage();
		}

		task("And New filter modal is closed and the changes are applied"){
			AssertVisible(locator1 = "FrontendDataSetAdmin#FILTERS_ENTRY",
			key_entryName = "Test");
		}
	}
}
