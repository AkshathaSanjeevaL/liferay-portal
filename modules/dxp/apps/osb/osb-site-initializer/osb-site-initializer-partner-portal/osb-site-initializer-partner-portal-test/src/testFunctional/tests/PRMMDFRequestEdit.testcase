@component-name = "OSB Site Initializer Partner Portal"
definition {

	property custom.properties = "feature.flag.LPS-135430=true";
	property osgi.modules.includes = "osb-site-initializer-partner-portal";
	property portal.release = "false";
	property portal.upstream = "true";
	property release.feature.flags.disable.DISABLE_PRIVATE_LAYOUTS = "true";
	property testray.main.component.name = "OSB Site Initializer Partner Portal";

	setUp {
		task ("Set up instance and sign in") {
			TestCase.setUpPortalInstance();

			User.firstLoginPG();
		}

		task ("Create a new Partner Portal Site and connect with Salesforce") {
			PRMUtils.addSite();

			PRMUtils.connectWithSalesforce();
		}

		task ("Update the account with Salesforce fields") {
			JSONPRM.updateAccount();
		}

		task ("Login with the Partner user and create an MDF Request") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "pmu@partner.com",
				userLoginFullName = "pmu");

			var requestId = JSONPRM.createMDFRequest(
				campaignName = "Campaign Name",
				userEmailAddress = "pmu@partner.com");
		}

		task ("Go to the created MDF Request") {
			PRMNavigator.openSitePage(pageName = "MDF Requests");

			PRMMDFRequest.goToMDF(campaignName = "Campaign Name");
		}
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if (${testPortalInstance} == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			PRMUtils.tearDown();
		}
	}

	@description = "This is a test for LPS-182807. Verify that the CMM can edit MDF in Approved status"
	@priority = 5
	test CMMCanEditMDFInApprovedStatus {
		property test.name.skip.portal.instance = "PRMMDFRequestEdit#CMMCanEditMDFInApprovedStatus";

		task ("Given that the CMM goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "cmm@liferaytest.com",
				userLoginFullName = "cmm");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Approve");
		}

		task ("When the CMM edit the MDF information and submit it") {
			PRMMDFRequest.editButton();

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the information will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182809. Verify that the CMM can edit MDF in Canceled status"
	@priority = 5
	test CMMCanEditMDFInCanceledStatus {
		property test.name.skip.portal.instance = "PRMMDFRequestEdit#CMMCanEditMDFInCanceledStatus";

		task ("Given that the CMM goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "cmm@liferaytest.com",
				userLoginFullName = "cmm");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Cancel");
		}

		task ("When the CMM edit the MDF information and submit it") {
			PRMMDFRequest.editButton();

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the information will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-179227. Verify that the CMM can edit MDF in Marketing Director Review status"
	@priority = 5
	test CMMCanEditMDFInMarketingDirectorReviewStatus {
		property test.name.skip.portal.instance = "PRMMDFRequestEdit#CMMCanEditMDFInMarketingDirectorReviewStatus";

		task ("Given that the CMM goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "cmm@liferaytest.com",
				userLoginFullName = "cmm");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Marketing Director Review");
		}

		task ("When the CMM edit the MDF information and submit it") {
			PRMMDFRequest.editButton();

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the information will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182806. Verify that the CMM can edit MDF in Pending Marketing Review status"
	@priority = 5
	test CMMCanEditMDFInPendingMarketingReviewStatus {
		property test.name.skip.portal.instance = "PRMMDFRequestEdit#CMMCanEditMDFInPendingMarketingReviewStatus";

		task ("Given that the CMM goes to the submitted MDF, which is as 'Pending Marketing Review'") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "cmm@liferaytest.com",
				userLoginFullName = "cmm");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("When the CMM edit the MDF information and submit it") {
			PRMMDFRequest.editButton();

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the information will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

	@description = "This is a test for LPS-182808. Verify that the CMM can edit MDF in Rejected status"
	@priority = 5
	test CMMCanEditMDFInRejectedStatus {
		property test.name.skip.portal.instance = "PRMMDFRequestEdit#CMMCanEditMDFInRejectedStatus";

		task ("Given that the CMM goes to the submitted MDF") {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "cmm@liferaytest.com",
				userLoginFullName = "cmm");

			PRMNavigator.gotoMDF(requestId = ${staticRequestId});
		}

		task ("And change the MDF status") {
			PRMMDFRequest.changeMDFStatus(statusButton = "Rejected");
		}

		task ("When the CMM edit the MDF information and submit it") {
			PRMMDFRequest.editButton();

			PRMMDFRequest.editMDF(
				campaignName = "Campaign Name Edited",
				newActivityName = "Activity Name Edited",
				newBugdetValue = 2000);
		}

		task ("Then the informations will be updated") {
			PRMNavigator.gotoMDF(requestId = ${staticRequestId});

			PRMMDFRequest.viewMDFCompanyDetails(campaignName = "Campaign Name Edited");

			PRMMDFRequest.viewMDFActivityDetails(
				activityName = "Activity Name Edited",
				budget = "2,000",
				expense = "Content Creation");
		}
	}

}